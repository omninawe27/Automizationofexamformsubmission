<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Exam Form System{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <!-- Enhanced Interactive Navbar -->
    <nav class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white shadow-lg sticky top-0 z-50 backdrop-blur-sm bg-opacity-95">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <!-- Logo with animation -->
                <div class="flex items-center space-x-2">
                    <div class="text-2xl animate-bounce">üìö</div>
                    <a href="{% url 'home' %}" class="text-xl font-bold hover:text-yellow-300 transition-colors duration-300">
                        ExamForm
                    </a>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-6">
                    {% if not user.is_authenticated %}
                        <a href="{% url 'home' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Home</a>
                        <a href="{% url 'login' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Login</a>
                    {% else %}
                        {% if user.role == 'admin' %}
                            <a href="{% url 'admin_dashboard' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Admin Dashboard</a>
                            <a href="{% url 'admin_register' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Register</a>
                            <a href="{% url 'edit_profile' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Profile</a>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm">{{ user.username }} (Admin)</span>
                            </div>
                        {% else %}
                            <a href="{% url 'student_dashboard' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Dashboard</a>
                            <a href="{% url 'fill_exam_form' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Exam Form</a>
                            <a href="{% url 'receipts' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Receipts</a>
                            <a href="{% url 'edit_profile' %}" class="nav-link hover:text-yellow-300 transition-colors duration-300 font-medium">Profile</a>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm">{{ user.username }}</span>
                            </div>
                        {% endif %}
                        <a href="{% url 'logout' %}" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full font-medium transition-colors duration-300">Logout</a>
                    {% endif %}
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white focus:outline-none">
                        <div class="w-6 h-6 flex flex-col justify-center items-center">
                            <span id="hamburger-line-1" class="block w-5 h-0.5 bg-white transition-all duration-300"></span>
                            <span id="hamburger-line-2" class="block w-5 h-0.5 bg-white mt-1 transition-all duration-300"></span>
                            <span id="hamburger-line-3" class="block w-5 h-0.5 bg-white mt-1 transition-all duration-300"></span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden max-h-0 opacity-0 overflow-hidden transition-all duration-300 bg-indigo-700 mt-4 rounded-lg">
                <div class="px-4 py-4 space-y-4">
                    {% if not user.is_authenticated %}
                        <a href="{% url 'home' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üè† Home</a>
                        <a href="{% url 'login' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üîê Login</a>
                    {% else %}
                        {% if user.role == 'admin' %}
                            <a href="{% url 'admin_dashboard' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üìä Admin Dashboard</a>
                            <a href="{% url 'admin_register' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üìù Register</a>
                            <div class="flex items-center space-x-2 py-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm text-white">{{ user.username }} (Admin)</span>
                            </div>
                        {% else %}
                            <a href="{% url 'student_dashboard' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üìä Dashboard</a>
                            <a href="{% url 'fill_exam_form' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üìù Exam Form</a>
                            <a href="{% url 'receipts' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üßæ Receipts</a>
                            <a href="{% url 'edit_profile' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300">üë§ Profile</a>
                            <div class="flex items-center space-x-2 py-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm text-white">{{ user.username }}</span>
                            </div>
                        {% endif %}
                        <a href="{% url 'logout' %}" class="block bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-center font-medium transition-colors duration-300">üö™ Logout</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Scroll Progress Bar -->
        <div id="scroll-progress" class="fixed top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 to-orange-500 transform scale-x-0 origin-left z-50"></div>
    </nav>

    <div class="container mx-auto px-4 py-8 animate-fade-in">
        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="max-w-4xl mx-auto mb-4 p-4 rounded-lg shadow-md animate-slide-up
                        {% if message.tags == 'error' %}bg-red-50 border-l-4 border-red-500 text-red-700
                        {% elif message.tags == 'warning' %}bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700
                        {% else %}bg-green-50 border-l-4 border-green-500 text-green-700{% endif %}">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                {% if message.tags == 'error' %}
                                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                    </svg>
                                {% elif message.tags == 'warning' %}
                                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                {% else %}
                                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                {% endif %}
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium">{{ message }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}{% endblock %}
    </div>

    <script>
        // Enhanced Mobile menu toggle with animations
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const hamburgerLines = [
            document.getElementById('hamburger-line-1'),
            document.getElementById('hamburger-line-2'),
            document.getElementById('hamburger-line-3')
        ];

        let isMenuOpen = false;

        mobileMenuButton.addEventListener('click', function() {
            isMenuOpen = !isMenuOpen;

            if (isMenuOpen) {
                mobileMenu.classList.remove('hidden');
                setTimeout(() => {
                    mobileMenu.classList.remove('max-h-0', 'opacity-0');
                    mobileMenu.classList.add('max-h-96', 'opacity-100');
                }, 10);

                // Animate hamburger to X
                hamburgerLines[0].classList.add('rotate-45', 'translate-y-1.5');
                hamburgerLines[1].classList.add('opacity-0');
                hamburgerLines[2].classList.add('-rotate-45', '-translate-y-1.5');
            } else {
                mobileMenu.classList.remove('max-h-96', 'opacity-100');
                mobileMenu.classList.add('max-h-0', 'opacity-0');
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 300);

                // Animate X back to hamburger
                hamburgerLines[0].classList.remove('rotate-45', 'translate-y-1.5');
                hamburgerLines[1].classList.remove('opacity-0');
                hamburgerLines[2].classList.remove('-rotate-45', '-translate-y-1.5');
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target) && isMenuOpen) {
                mobileMenuButton.click();
            }
        });

        // Scroll progress bar
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.offsetHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            document.getElementById('scroll-progress').style.transform = `scaleX(${scrollPercent / 100})`;
        });

        // Navbar scroll effect
        let lastScrollTop = 0;
        const navbar = document.querySelector('nav');

        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > lastScrollTop && scrollTop > 100) {
                // Scrolling down
                navbar.style.transform = 'translateY(-100%)';
            } else {
                // Scrolling up
                navbar.style.transform = 'translateY(0)';
            }

            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        });

        // Form validation and interactivity for login page
        if (document.getElementById('login-form')) {
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginBtn = document.getElementById('login-btn');
            const loginText = document.getElementById('login-text');
            const loginSpinner = document.getElementById('login-spinner');
            const usernameError = document.getElementById('username-error');
            const passwordError = document.getElementById('password-error');

            // Real-time validation
            usernameInput.addEventListener('input', function() {
                if (this.value.length < 3) {
                    usernameError.classList.remove('hidden');
                    this.classList.add('border-red-500');
                } else {
                    usernameError.classList.add('hidden');
                    this.classList.remove('border-red-500');
                }
            });

            passwordInput.addEventListener('input', function() {
                if (this.value.length < 6) {
                    passwordError.classList.remove('hidden');
                    this.classList.add('border-red-500');
                } else {
                    passwordError.classList.add('hidden');
                    this.classList.remove('border-red-500');
                }
            });

            // Form submission with loading state
            loginForm.addEventListener('submit', function(e) {
                const isValid = usernameInput.value.length >= 3 && passwordInput.value.length >= 6;
                if (!isValid) {
                    e.preventDefault();
                    if (usernameInput.value.length < 3) usernameError.classList.remove('hidden');
                    if (passwordInput.value.length < 6) passwordError.classList.remove('hidden');
                    return;
                }

                loginBtn.disabled = true;
                loginText.textContent = 'Signing In...';
                loginSpinner.classList.remove('hidden');
            });
        }

        // Form validation and interactivity for register page
        if (document.getElementById('register-form')) {
            const registerForm = document.getElementById('register-form');
            const registerBtn = document.getElementById('register-btn');
            const registerText = document.getElementById('register-text');
            const registerSpinner = document.getElementById('register-spinner');

            // Password requirements validation
            const passwordInput = document.getElementById('id_password1');
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    const password = this.value;

                    // Length check
                    const lengthReq = document.getElementById('req-length');
                    const lengthSpan = lengthReq.querySelector('span');
                    if (password.length >= 8) {
                        lengthSpan.classList.remove('border-gray-300');
                        lengthSpan.classList.add('bg-green-500', 'border-green-500');
                    } else {
                        lengthSpan.classList.remove('bg-green-500', 'border-green-500');
                        lengthSpan.classList.add('border-gray-300');
                    }

                    // Uppercase check
                    const upperReq = document.getElementById('req-uppercase');
                    const upperSpan = upperReq.querySelector('span');
                    if (/[A-Z]/.test(password)) {
                        upperSpan.classList.remove('border-gray-300');
                        upperSpan.classList.add('bg-green-500', 'border-green-500');
                    } else {
                        upperSpan.classList.remove('bg-green-500', 'border-green-500');
                        upperSpan.classList.add('border-gray-300');
                    }

                    // Lowercase check
                    const lowerReq = document.getElementById('req-lowercase');
                    const lowerSpan = lowerReq.querySelector('span');
                    if (/[a-z]/.test(password)) {
                        lowerSpan.classList.remove('border-gray-300');
                        lowerSpan.classList.add('bg-green-500', 'border-green-500');
                    } else {
                        lowerSpan.classList.remove('bg-green-500', 'border-green-500');
                        lowerSpan.classList.add('border-gray-300');
                    }

                    // Number check
                    const numberReq = document.getElementById('req-number');
                    const numberSpan = numberReq.querySelector('span');
                    if (/\d/.test(password)) {
                        numberSpan.classList.remove('border-gray-300');
                        numberSpan.classList.add('bg-green-500', 'border-green-500');
                    } else {
                        numberSpan.classList.remove('bg-green-500', 'border-green-500');
                        numberSpan.classList.add('border-gray-300');
                    }

                    // Special character check
                    const specialReq = document.getElementById('req-special');
                    const specialSpan = specialReq.querySelector('span');
                    if (/[!@#$%^&*]/.test(password)) {
                        specialSpan.classList.remove('border-gray-300');
                        specialSpan.classList.add('bg-green-500', 'border-green-500');
                    } else {
                        specialSpan.classList.remove('bg-green-500', 'border-green-500');
                        specialSpan.classList.add('border-gray-300');
                    }
                });
            }

            // Form submission with loading state
            registerForm.addEventListener('submit', function(e) {
                registerBtn.disabled = true;
                registerText.textContent = 'Creating Account...';
                registerSpinner.classList.remove('hidden');
            });
        }

        // Typing animation for home page
        if (document.getElementById('typing-text')) {
            const typingText = document.getElementById('typing-text');
            const originalText = typingText.textContent;
            let i = 0;
            let isDeleting = false;

            function typeWriter() {
                const currentText = isDeleting
                    ? originalText.substring(0, i--)
                    : originalText.substring(0, i++);

                typingText.textContent = currentText;

                if (!isDeleting && i === originalText.length) {
                    setTimeout(() => isDeleting = true, 2000);
                } else if (isDeleting && i === 0) {
                    isDeleting = false;
                }

                const speed = isDeleting ? 50 : 100;
                setTimeout(typeWriter, speed);
            }

            // Start typing animation after a delay
            setTimeout(typeWriter, 1000);
        }

        // Counter animation for stats
        function animateCounters() {
            const counters = document.querySelectorAll('[data-target]');
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const count = +counter.innerText;
                const increment = target / 200;

                if (count < target) {
                    counter.innerText = Math.ceil(count + increment);
                    setTimeout(animateCounters, 10);
                } else {
                    counter.innerText = target;
                }
            });
        }

        // Trigger counter animation when stats section is visible
        const statsSection = document.querySelector('.bg-gradient-to-r.from-indigo-600.to-purple-600');
        if (statsSection) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateCounters();
                        observer.unobserve(entry.target);
                    }
                });
            });
            observer.observe(statsSection);
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Demo functions for home page
        function demoForm() {
            // Navigate to login page
            window.location.href = '{% url "login" %}';
        }

        function scrollToStats() {
            const statsSection = document.querySelector('.bg-gradient-to-r.from-indigo-600.to-purple-600');
            if (statsSection) {
                statsSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Enhanced navbar hover effects
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            link.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Add animation delays to CSS
        const style = document.createElement('style');
        style.textContent = `
            .animation-delay-200 { animation-delay: 0.2s; }
            .animation-delay-300 { animation-delay: 0.3s; }
            .animation-delay-400 { animation-delay: 0.4s; }
            .animation-delay-600 { animation-delay: 0.6s; }
            .animation-delay-800 { animation-delay: 0.8s; }
            .animation-delay-1000 { animation-delay: 1s; }
            .animation-delay-2000 { animation-delay: 2s; }
            .animation-delay-3000 { animation-delay: 3s; }

            /* Custom animations for enhanced interactivity */
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }

            .animate-float {
                animation: float 3s ease-in-out infinite;
            }

            /* Smooth transitions for all interactive elements */
            * {
                transition-property: transform, opacity, box-shadow;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
